<% url = Parcelas::Application.routes.url_helpers %>

$(document).ready(function(){
    var long = 107533.140625, lat = 102836.5234375,
            getUrl = function(lat, long, cat) {
                var url = '<%= url.application_index_path %>';
                url += '?lat=' + lat;
                url += '&long=' + long;
                url += '&cat=' + encodeURIComponent(cat);
                return url;
            };

   $.backstretch("<%= asset_path 'background-landing.png' %>");



   $('#search-button').on('click', function(ev) {
       $(ev.currentTarget).attr('href', getUrl(lat, long, $.trim($('#cat-search').val())));
   });

    $('#search-button').on('keyup', function(ev) {
        if(ev.keyCode != 13){
            return;
        }
        window.location.href = getUrl(lat, long, $.trim($('#cat-search').val()));
    });

    $('#explorar-btn').on('click', function(ev) {
        $(ev.currentTarget).attr('href', getUrl(102836.5234375, 107533.140625, ""));
    });

    $('#explorar-btn').on('keyup', function(ev) {
        if(ev.keyCode != 13){
            return;
        }
        window.location.href = getUrl(102836.5234375, 107533.140625, "");
    });


    var searchable = {
        search : function(query, isNearbyQuery) {
            $('#dir').focus(); return;
        }
    };
    Searchbox.init(searchable, function() { return true; });

    AutocompleteGcba.init('dir', function(direction) {
        long = direccion.getCoordenadas().getX();
        lat = direccion.getCoordenadas().getY();
        $('.current-target b').text(direccion.toString());
    });

    $('#cat-search').focus();
});