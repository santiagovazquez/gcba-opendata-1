<% url = Parcelas::Application.routes.url_helpers %>

var Searchbox = function(){

    //functions
    var registerHandlers,
        doSearch,
        getSearchEndpoint,
        setMapModule,
        getMapModule,
        mapModule;

    getSearchEndpoint = function(query){
        return "parcelas-by-category/" + encodeURIComponent(query);
    }

    doSearch = function(query){
        $("#loading").show();
        $.getJSON(getSearchEndpoint(query), function(data){
            getMapModule().drawOverGoogleMap(data);
        });
    }

    registerHandlers = function(){
        $("#searchbar").keyup(function(event){
            if(event.keyCode == 13){
                doSearch(this.value);
            }
        });

        $("#searchButton").click(function(){
           doSearch($("#searchbar").val());
        });
    }

    getMapModule = function(){
        return mapModule;
    }

    setMapModule = function(module){
        mapModule = module;
    }

    return {
        init : function(mapModule){
            setMapModule(mapModule);
            registerHandlers();

        }
    }
}();