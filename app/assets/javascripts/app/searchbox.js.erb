<% url = Parcelas::Application.routes.url_helpers %>
var Searchbox = function(){

    //functions
    var registerHandlers,
        doSearch,
        getSearchEndpoint,
        setMapModule,
        getMapModule,
        mapModule,
        registerLocationSearchHandlers;

    doSearch = function(query, isNearby){
        getMapModule().search(query, isNearby);
    }

    registerLocationSearchHandlers = function(){
        $('a.location-search-button').click(function(){
            var searchBar = $(this).closest('div').find('.location-search-bar');
            var query = searchBar.val();

            if(query.length > 2){
                doSearch(query, true);
            }
        });

        $('input.location-search-bar').keyup(function(event){
            var searchButton = $(this).closest('div').find('.location-search-button');

            if(this.value.length > 2){
                searchButton.removeClass("disabled");
            } else{
                searchButton.addClass("disabled");
            }

            if(event.keyCode == 13 && this.value.length > 2){
                doSearch(this.value, true);
            }
        });
    }

    registerHandlers = function(){
        $('.search-bar').keyup(function(event){
            var searchButton = $(this).closest('div').find('.search-button');

            if(this.value.length > 2){
                searchButton.removeClass("disabled");
            } else{
                searchButton.addClass("disabled");
            }

            if(event.keyCode == 13 && this.value.length > 2){
                doSearch(this.value);
            }
        });

        $('.search-button').click(function(){
            var searchBar = $(this).closest('div').find('.search-bar');
            var query = searchBar.val();

            if(query.length > 2){
                doSearch(query);
            }
        });
    }

    getMapModule = function(){
        return mapModule;
    }

    setMapModule = function(module){
        mapModule = module;
    }

    return {
        init : function(mapModule){
            setMapModule(mapModule);
            registerHandlers();
        },

        registerLocationSearchHandlers : registerLocationSearchHandlers
    }
}();