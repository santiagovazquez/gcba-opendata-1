$(document).ready(function(){

    _.templateSettings = {
        interpolate: /\{\{\=(.+?)\}\}/g,
        evaluate: /\{\{(.+?)\}\}/g
    };

    StatusBar.init();
    Map.init();
    Searchbox.init(Map, function() { return true; });
    NavigationBar.init();

    AutocompleteGcba.init('autocomplete-bsas', function(direction) {
        long = direccion.getCoordenadas().getX();
        lat = direccion.getCoordenadas().getY();

        //$('.current-target b').text(direccion.toString());
    });


    var urlParams = {};
    (function () {
        var match,
                pl     = /\+/g,  // Regex for replacing addition symbol with a space
                search = /([^&=]+)=?([^&]*)/g,
                decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
                query  = window.location.search.substring(1);

        while (match = search.exec(query))
            urlParams[decode(match[1])] = decode(match[2]);
    })();

    var exploreFlag = urlParams["explore"];

    if(typeof(exploreFlag) !== "undefined" && exploreFlag !== ""){
        $('#introduction-modal').modal('show');
    }

//    $('#introduction-modal').modal('show');

    $('html').ajaxError(function(){
        $('#loading').hide();
        $('.navbar-search').show();
        StatusBar.showErrorMessage("Ooops, hubo un error en la comunicación con el servidor. Proba de nuevo más tarde.");
    });
});